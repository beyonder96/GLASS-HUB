@page "/agenda"
@inject IExpenseService ExpenseService
@inject SettingsService SettingsService
@using System.Globalization

<div class="animate-fade-in max-w-[1200px] mx-auto pb-32">
    
    <!-- Main Card -->
    <div class="glass-panel rounded-[40px] p-8 relative overflow-hidden">
        
        <!-- Header -->
        <div class="flex items-center justify-between mb-8">
            <div class="flex items-center gap-4">
                <div class="w-12 h-12 rounded-2xl bg-indigo-600/20 text-indigo-500 flex items-center justify-center border border-indigo-500/20">
                     <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect width="18" height="18" x="3" y="4" rx="2" ry="2"/><line x1="16" x2="16" y1="2" y2="6"/><line x1="8" x2="8" y1="2" y2="6"/><line x1="3" x2="21" y1="10" y2="10"/></svg>
                </div>
                <div>
                    <h2 class="text-2xl font-bold text-slate-900 dark:text-white capitalize leading-none">@CurrentDate.ToString("MMMM", new CultureInfo("pt-BR"))</h2>
                    <span class="text-slate-500 dark:text-zinc-500 font-medium">@CurrentDate.Year</span>
                </div>
            </div>

            <div class="flex items-center gap-2 bg-slate-100 dark:bg-zinc-900/50 p-1 rounded-xl border border-slate-200 dark:border-white/5">
                <button @onclick="PrevMonth" class="w-8 h-8 flex items-center justify-center rounded-lg hover:bg-white dark:hover:bg-white/10 text-slate-500 dark:text-zinc-400 hover:text-slate-900 dark:hover:text-white transition-colors">
                    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m15 18-6-6 6-6"/></svg>
                </button>
                <button @onclick="NextMonth" class="w-8 h-8 flex items-center justify-center rounded-lg hover:bg-white dark:hover:bg-white/10 text-slate-500 dark:text-zinc-400 hover:text-slate-900 dark:hover:text-white transition-colors">
                    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m9 18 6-6-6-6"/></svg>
                </button>
            </div>
            
            <button @onclick="() => IsHolidayModalOpen = true" class="ml-4 p-2 rounded-xl bg-slate-100 dark:bg-zinc-900 text-slate-500 dark:text-zinc-400 hover:text-rose-500 dark:hover:text-rose-500 transition-colors" title="Adicionar Feriado">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect width="18" height="18" x="3" y="4" rx="2" ry="2"/><line x1="16" x2="16" y1="2" y2="6"/><line x1="8" x2="8" y1="2" y2="6"/><line x1="3" x2="21" y1="10" y2="10"/><path d="M12 14h4"/><path d="M14 12v4"/></svg>
            </button>
        </div>

        <!-- Weekday Headers -->
        <div class="grid grid-cols-7 mb-4 px-2">
            @foreach (var day in new[] { "DOM", "SEG", "TER", "QUA", "QUI", "SEX", "SÁB" })
            {
                <div class="text-center text-[11px] font-bold uppercase tracking-widest opacity-80 @(day == "DOM" || day == "SÁB" ? "text-rose-500" : "text-slate-400 dark:text-zinc-500")">
                     @day
                </div>
            }
        </div>

        <!-- Calendar Grid -->
        <div class="grid grid-cols-7 gap-3">
            @foreach (var day in CalendarDays)
            {
                <div @onclick="() => SelectDay(day)" 
                     class="group relative aspect-[1/1.1] rounded-[20px] transition-all duration-300 cursor-pointer overflow-hidden border flex flex-col items-center justify-between py-4
                            @(day.IsCurrentMonth ? "opacity-100" : "opacity-30 grayscale")
                            @(IsToday(day.Date) 
                                ? "bg-[#5046e5] border-[#5046e5] shadow-[0_0_30px_-5px_rgba(80,70,229,0.5)] z-10 scale-105" 
                                : "bg-slate-50 dark:bg-[#0c0c0e] border-slate-200 dark:border-white/5 hover:border-slate-300 dark:hover:border-white/20 hover:bg-white dark:hover:bg-[#121214]")">
                    
                    <!-- Top: Date -->
                    <span class="text-lg font-bold @(IsToday(day.Date) ? "text-white" : "text-slate-700 dark:text-white")">
                        @day.Date.Day
                    </span>

                    <!-- Middle: Info -->
                    <div class="flex flex-col items-center gap-1">
                        @if(day.TotalValue > 0)
                        {
                            <span class="text-[10px] font-bold @(IsToday(day.Date) ? "text-white/90" : "text-slate-600 dark:text-white")">
                                @FormatShortCurrency(day.TotalValue)
                            </span>
                            <div class="flex gap-[3px]">
                                @if (day.HasPending) { <div class="w-1 h-1 rounded-full bg-indigo-400"></div> }
                                @if (day.HasPaid) { <div class="w-1 h-1 rounded-full bg-emerald-400"></div> }
                                @if (day.HasOverdue) { <div class="w-1 h-1 rounded-full bg-rose-400"></div> }
                            </div>
                        }
                        @if(day.IsHoliday)
                        {
                             <svg xmlns="http://www.w3.org/2000/svg" width="10" height="10" viewBox="0 0 24 24" fill="currentColor" class="@(IsToday(day.Date) ? "text-white" : "text-rose-500")"><path d="M4 15s1-1 4-1 5 2 8 2 4-1 4-1V3s-1 1-4 1-5-2-8-2-4 1-4 1z"/><line x1="4" x2="4" y1="22" y2="15" stroke="currentColor" stroke-width="2"/></svg>
                        }
                    </div>

                    <!-- Bottom Spacer for alignment -->
                    <div class="h-1"></div>
                </div>
            }
        </div>

        <!-- Footer Legend -->
        <div class="flex items-center justify-center gap-8 mt-12 mb-2 border-t border-slate-200 dark:border-white/5 pt-8">
            <div class="flex items-center gap-2">
                <div class="w-1.5 h-1.5 rounded-full bg-indigo-500"></div>
                <span class="text-[10px] font-bold text-zinc-500 uppercase tracking-widest">Pendente</span>
            </div>
            <div class="flex items-center gap-2">
                <div class="w-1.5 h-1.5 rounded-full bg-emerald-500"></div>
                <span class="text-[10px] font-bold text-zinc-500 uppercase tracking-widest">Pago</span>
            </div>
            <div class="flex items-center gap-2">
                <div class="w-1.5 h-1.5 rounded-full bg-rose-500"></div>
                <span class="text-[10px] font-bold text-zinc-500 uppercase tracking-widest">Vencido</span>
            </div>
            <div class="flex items-center gap-2">
                <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-rose-500"><path d="M4 15s1-1 4-1 5 2 8 2 4-1 4-1V3s-1 1-4 1-5-2-8-2-4 1-4 1z"/><line x1="4" x2="4" y1="22" y2="15"/></svg>
                <span class="text-[10px] font-bold text-zinc-500 uppercase tracking-widest">Feriado</span>
            </div>
        </div>
    </div>
    
    <!-- Glassmorphism Detail Modal -->
    @if (SelectedDay != null)
    {
        <div class="fixed inset-0 z-[100] flex items-center justify-center p-4 animate-fade-in">
            <!-- Backdrop -->
            <div class="absolute inset-0 bg-black/80 backdrop-blur-md" @onclick="CloseModal"></div>
            
            <!-- Modal Content -->
            <div class="relative w-full max-w-md bg-white dark:bg-[#09090b] border border-slate-200 dark:border-white/10 rounded-[32px] shadow-2xl dark:shadow-black overflow-hidden scale-100 animate-fade-in-up">
                
                <!-- Header -->
                <div class="p-6 bg-gradient-to-br from-slate-50 dark:from-white/5 to-transparent border-b border-slate-200 dark:border-white/5 flex justify-between items-start">
                    <div>
                        <h2 class="text-2xl font-bold text-slate-800 dark:text-white capitalize">
                            @SelectedDay.Date.ToString("dddd", new CultureInfo("pt-BR"))
                        </h2>
                        <div class="flex items-center gap-2 mt-1">
                             <span class="text-slate-500 dark:text-zinc-400 text-sm">@SelectedDay.Date.ToString("d 'de' MMMM", new CultureInfo("pt-BR"))</span>
                             @if(SelectedDay.IsHoliday)
                             {
                                 <span class="px-2 py-0.5 rounded-full bg-rose-500/10 text-rose-500 text-[10px] font-bold uppercase border border-rose-500/20">Feriado</span>
                             }
                        </div>
                    </div>
                    
                    <button @onclick="CloseModal" class="p-2 rounded-full hover:bg-slate-100 dark:hover:bg-white/10 text-slate-400 dark:text-zinc-400 hover:text-slate-900 dark:hover:text-white transition-colors">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 6 6 18"/><path d="m6 6 12 12"/></svg>
                    </button>
                </div>

                <!-- Content list -->
                <div class="p-6 space-y-4 max-h-[60vh] overflow-y-auto">
                    @if (GetDayItems(SelectedDay.Date).Any())
                    {
                        var items = GetDayItems(SelectedDay.Date);
                        <div class="flex justify-between items-end mb-4">
                            <span class="text-xs font-bold text-slate-500 dark:text-zinc-500 uppercase tracking-wider">Lançamentos do dia</span>
                            <div class="text-right">
                                <span class="text-xl font-bold text-slate-900 dark:text-white block">@FormatCurrency(SelectedDay.TotalValue)</span>
                                @if (SettingsService.DailyBuffer > 0)
                                {
                                    <span class="text-[10px] text-indigo-500 font-medium block">+ @FormatCurrency(SettingsService.DailyBuffer) (Buffer)</span>
                                }
                            </div>
                        </div>
                        
                        @foreach (var item in items)
                        {
                            <div class="p-4 rounded-2xl bg-slate-50 dark:bg-zinc-900/50 border border-slate-200 dark:border-white/5 flex items-center justify-between group hover:bg-slate-100 dark:hover:bg-zinc-800/50 transition-colors">
                                <div class="flex items-center gap-3">
                                    <div class="w-10 h-10 rounded-xl bg-white dark:bg-black/40 flex items-center justify-center border border-slate-200 dark:border-white/5 @GetStatusColor(item.Status)">
                                        @if(item.IsManual) {
                                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/></svg>
                                        } else {
                                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/><line x1="16" x2="8" y1="13" y2="13"/><line x1="16" x2="8" y1="17" y2="17"/><polyline points="10 9 9 9 8 9"/></svg>
                                        }
                                    </div>
                                    <div>
                                        <p class="font-bold text-slate-700 dark:text-zinc-200 text-sm leading-tight">@item.Description</p>
                                        <p class="text-[10px] text-slate-500 dark:text-zinc-500 uppercase tracking-wide mt-0.5">@item.SubDescription</p>
                                    </div>
                                </div>
                                <div class="text-right">
                                    <p class="font-bold text-slate-900 dark:text-white text-sm">@FormatCurrency(item.Value)</p>
                                    <p class="text-[10px] uppercase font-bold @GetStatusTextColor(item.Status)">@TranslateStatus(item.Status)</p>
                                </div>
                            </div>
                        }
                    }
                    else
                    {
                        <div class="flex flex-col items-center justify-center py-12 text-zinc-600">
                            <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="mb-4 opacity-50"><rect width="18" height="18" x="3" y="4" rx="2" ry="2"/><line x1="16" x2="16" y1="2" y2="6"/><line x1="8" x2="8" y1="2" y2="6"/><line x1="3" x2="21" y1="10" y2="10"/></svg>
                            <p class="text-sm font-medium">Sem lançamentos para este dia</p>
                        </div>
                    }
                </div>

                <!-- Footer Actions -->
                <div class="p-4 bg-slate-100 dark:bg-zinc-900 border-t border-slate-200 dark:border-white/5">
                    <button @onclick="() => OpenAddModal(SelectedDay.Date)" class="w-full py-3.5 rounded-xl bg-indigo-600 hover:bg-indigo-500 text-white font-bold text-sm transition-colors shadow-lg shadow-indigo-500/20">
                        + Adicionar Lançamento
                    </button>
                </div>
            </div>
        </div>
    }

    <!-- Add Holiday Modal -->
    @if (IsHolidayModalOpen)
    {
        <div class="fixed inset-0 z-[100] flex items-center justify-center p-4 animate-fade-in">
            <div class="absolute inset-0 bg-black/80 backdrop-blur-md" @onclick="() => IsHolidayModalOpen = false"></div>
            <div class="relative w-full max-w-sm bg-white dark:bg-[#09090b] border border-slate-200 dark:border-white/10 rounded-3xl p-6 shadow-2xl scale-100 animate-fade-in-up">
                 <h3 class="font-bold text-lg text-slate-800 dark:text-white mb-4">Gerenciar Feriados</h3>
                 
                 <div class="space-y-4">
                     <div>
                         <label class="text-xs font-bold text-slate-500 uppercase tracking-wider block mb-2">Data do Feriado</label>
                         <input type="date" @bind="NewHolidayDate" class="w-full px-4 py-3 rounded-xl bg-slate-50 dark:bg-zinc-900 border border-slate-200 dark:border-zinc-800 focus:ring-2 focus:ring-indigo-500 focus:outline-none dark:text-white" />
                     </div>
                     <button @onclick="AddHoliday" class="w-full py-3 rounded-xl bg-indigo-600 hover:bg-indigo-500 text-white font-bold text-sm transition-colors shadow-lg shadow-indigo-500/20">
                        Adicionar Feriado
                     </button>
                     
                     @if (CustomHolidays.Any())
                     {
                         <div class="mt-4 pt-4 border-t border-slate-100 dark:border-white/5 space-y-2 max-h-40 overflow-y-auto">
                             @foreach(var h in CustomHolidays)
                             {
                                 <div class="flex justify-between items-center text-sm p-2 rounded-lg bg-slate-50 dark:bg-zinc-900 border border-slate-100 dark:border-zinc-800">
                                     <span class="text-slate-700 dark:text-zinc-300">@h.ToString("dd/MM/yyyy")</span>
                                     <button @onclick="() => RemoveHoliday(h)" class="text-rose-500 hover:text-rose-400">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>
                                     </button>
                                 </div>
                             }
                         </div>
                     }
                 </div>
            </div>
        </div>
    }

    <GlassHub.Components.AddExpenseModal @bind-IsVisible="IsAddModalVisible" InitialDate="SelectedAddDate" />
</div>

@code {
    // Estado da Página
    private DateTime CurrentDate = DateTime.Today;
    private List<CalendarDay> CalendarDays = new();
    private CalendarDay? SelectedDay;
    
    // Add Modal State
    private bool IsAddModalVisible = false;
    private DateTime? SelectedAddDate;
    
    // Holiday State
    private bool IsHolidayModalOpen = false;
    private DateTime NewHolidayDate = DateTime.Today;
    private List<DateTime> CustomHolidays = new();

    #region Lifecycle Methods

    protected override void OnInitialized()
    {
        GenerateCalendar();
        // Assina evento de mudança de estado do serviço
        ExpenseService.OnChange += HandleChange;
        SettingsService.OnChange += HandleChange;
        
        // Initialize settings if not already
        _ = SettingsService.InitializeAsync();
    }

    public void Dispose()
    {
         // Remove assinatura para evitar memory leaks
         ExpenseService.OnChange -= HandleChange;
         SettingsService.OnChange -= HandleChange;
    }

    #endregion

    #region Event Handlers

    private void HandleChange()
    {
        // Recarrega o calendário quando houver mudança nos dados (ex: upload de XML)
        GenerateCalendar();
        StateHasChanged();
    }

    private void PrevMonth()
    {
        CurrentDate = CurrentDate.AddMonths(-1);
        GenerateCalendar();
    }

    private void NextMonth()
    {
        CurrentDate = CurrentDate.AddMonths(1);
        GenerateCalendar();
    }

    private void SelectDay(CalendarDay day)
    {
        SelectedDay = day;
    }

    private void CloseModal()
    {
        SelectedDay = null;
    }

    private void AddHoliday()
    {
        if (!CustomHolidays.Contains(NewHolidayDate.Date))
        {
            CustomHolidays.Add(NewHolidayDate.Date);
            GenerateCalendar();
        }
    }
    
    private void RemoveHoliday(DateTime date)
    {
        CustomHolidays.Remove(date.Date);
        GenerateCalendar();
    }

    private void OpenAddModal(DateTime date)
    {
        SelectedAddDate = date;
        IsAddModalVisible = true;
    }

    #endregion

    #region Calendar Logic

    private bool IsToday(DateTime date) => date.Date == DateTime.Today;

    private void GenerateCalendar()
    {
        CalendarDays.Clear();
        
        var year = CurrentDate.Year;
        var month = CurrentDate.Month;
        var firstDayOfMonth = new DateTime(year, month, 1);
        var daysInMonth = DateTime.DaysInMonth(year, month);
        
        // Lógica de Início no Domingo (Sunday Start)
        // DayOfWeek: 0 = Domingo, 1 = Segunda...
        int offset = (int)firstDayOfMonth.DayOfWeek; 

        // Preenchimento do mês anterior
        var prevMonthDate = firstDayOfMonth.AddMonths(-1);
        var daysInPrevMonth = DateTime.DaysInMonth(prevMonthDate.Year, prevMonthDate.Month);
        
        for (int i = 0; i < offset; i++)
        {
            var dayNum = daysInPrevMonth - offset + 1 + i;
            var date = new DateTime(prevMonthDate.Year, prevMonthDate.Month, dayNum);
            CalendarDays.Add(BuildDay(date, false));
        }

        // Preenchimento do mês atual
        for (int i = 1; i <= daysInMonth; i++)
        {
            var date = new DateTime(year, month, i);
            CalendarDays.Add(BuildDay(date, true));
        }

        // Preenchimento do próximo mês (para completar a grade visual)
        int remaining = 42 - CalendarDays.Count;
        var nextMonthDate = firstDayOfMonth.AddMonths(1);
        for (int i = 1; i <= remaining; i++)
        {
            var date = new DateTime(nextMonthDate.Year, nextMonthDate.Month, i);
            CalendarDays.Add(BuildDay(date, false));
        }
    }

    private CalendarDay BuildDay(DateTime date, bool isCurrentMonth)
    {
        var dayItems = GetDayItems(date);
        
        return new CalendarDay
        {
            Date = date,
            IsCurrentMonth = isCurrentMonth,
            IsHoliday = CheckHoliday(date),
            TotalValue = dayItems.Sum(x => x.Value) + SettingsService.DailyBuffer, // Include Buffer
            HasPending = dayItems.Any(x => x.Status == PaymentStatus.PENDING && x.DueDate >= DateTime.Today),
            HasPaid = dayItems.Any(x => x.Status == PaymentStatus.PAID),
            HasOverdue = dayItems.Any(x => x.Status == PaymentStatus.OVERDUE || (x.Status == PaymentStatus.PENDING && x.DueDate < DateTime.Today))
        };
    }

    private bool CheckHoliday(DateTime date)
    {
        // Feriados Nacionais Fixos
        if (date.Month == 1 && date.Day == 1) return true; // Confraternização Universal
        if (date.Month == 4 && date.Day == 21) return true; // Tiradentes
        if (date.Month == 5 && date.Day == 1) return true; // Trabalho
        if (date.Month == 9 && date.Day == 7) return true; // Independência
        if (date.Month == 10 && date.Day == 12) return true; // Padroeira
        if (date.Month == 11 && date.Day == 2) return true; // Finados
        if (date.Month == 11 && date.Day == 15) return true; // República
        if (date.Month == 12 && date.Day == 25) return true; // Natal
        
        // Feriados Móveis (Calculados para 2026 como base, idealmente seria algoritmo de Páscoa)
        // Carnaval 2026: 17/02
        if (date.Year == 2026 && date.Month == 2 && date.Day == 17) return true;
        // Sexta-feira Santa 2026: 03/04
        if (date.Year == 2026 && date.Month == 4 && date.Day == 3) return true;
        // Corpus Christi 2026: 04/06
        if (date.Year == 2026 && date.Month == 6 && date.Day == 4) return true;

        // Customizados
        if (CustomHolidays.Contains(date.Date)) return true;

        return false;
    }

    private List<FlowItem> GetDayItems(DateTime date)
    {
         var installments = ExpenseService.Invoices
            .SelectMany(inv => inv.Installments.Select(inst => new FlowItem 
            {
                Id = inst.Id,
                Description = inv.IssuerName,
                SubDescription = $"Parc. {inst.Number}",
                Value = inst.Value,
                DueDate = inst.DueDate,
                Status = inst.Status,
                IsManual = false
            }));

        var manuals = ExpenseService.ManualExpenses
            .Select(exp => new FlowItem 
            {
                Id = exp.Id,
                Description = exp.Description,
                SubDescription = exp.Category ?? "Manual",
                Value = exp.Value,
                DueDate = exp.DueDate,
                Status = exp.Status,
                IsManual = true
            });
            
        return installments.Concat(manuals)
            .Where(i => i.DueDate.Date == date.Date)
            .ToList();
    }

    #endregion

    #region Formatters & Helpers

    private string FormatCurrency(decimal value) => value.ToString("C", new CultureInfo("pt-BR"));
    
    private string FormatShortCurrency(decimal value) 
    {
        return value.ToString("N2", new CultureInfo("pt-BR"));
    }

    private string GetStatusColor(PaymentStatus status)
    {
         return status switch 
         {
             PaymentStatus.PAID => "text-emerald-500 bg-emerald-500/10 border-emerald-500/20",
             PaymentStatus.OVERDUE => "text-rose-500 bg-rose-500/10 border-rose-500/20",
             _ => "text-indigo-500 bg-indigo-500/10 border-indigo-500/20"
         };
    }
    
    private string GetStatusTextColor(PaymentStatus status)
    {
         return status switch 
         {
             PaymentStatus.PAID => "text-emerald-500",
             PaymentStatus.OVERDUE => "text-rose-500",
             _ => "text-indigo-500"
         };
    }

    private string TranslateStatus(PaymentStatus status)
    {
         return status switch 
         {
             PaymentStatus.PAID => "Pago",
             PaymentStatus.OVERDUE => "Atrasado",
             _ => "Pendente"
         };
    }

    #endregion

    #region View Models

    /// <summary>
    /// Modelo de visualização para um dia do calendário.
    /// </summary>
    public class CalendarDay
    {
        public DateTime Date { get; set; }
        public bool IsCurrentMonth { get; set; }
        public bool IsHoliday { get; set; }
        public decimal TotalValue { get; set; }
        public bool HasPending { get; set; }
        public bool HasPaid { get; set; }
        public bool HasOverdue { get; set; }
    }
    
    /// <summary>
    /// Modelo unificado para itens de fluxo (Parcelas ou Manuais).
    /// </summary>
    public class FlowItem
    {
        public string Id { get; set; } = "";
        public string Description { get; set; } = "";
        public string SubDescription { get; set; } = "";
        public decimal Value { get; set; }
        public DateTime DueDate { get; set; }
        public PaymentStatus Status { get; set; }
        public bool IsManual { get; set; }
    }

    #endregion
}
